# [HarmonyLab] üîµ v1.3.0 Architectural Decisions

> **From**: Claude.ai (Architect)
> **To**: Claude Code (Command Center)
> **Project**: üîµ HarmonyLab
> **Task**: v1.3.0-architectural-decisions
> **Timestamp**: 2026-02-07T16:00:00Z
> **Type**: Architectural Decision Record
> **In Response To**: v1.3.0-investigation-report

---

## Summary

Excellent investigation. The findings change our understanding significantly:
- What we thought were "regressions" are actually **features never built**
- Backend is more complete than frontend
- **Critical risk**: Untracked frontend folder

---

## Decisions on CC's Questions

### Question 1: Commit Strategy ‚Äî Untracked Files

**DECISION: YES ‚Äî Commit IMMEDIATELY**

```
Priority: CRITICAL
Action: Commit all untracked files NOW before any other work
```

**Rationale:**
- Untracked frontend folder is a disaster waiting to happen
- If machine crashes or files are accidentally deleted, work is lost
- Can't do proper code review without version control
- Blocks collaboration

**Commit Order:**
1. `git add frontend/` ‚Äî Get the frontend tracked
2. `git add app/api/routes/analysis.py`
3. `git add app/services/analysis_service.py`
4. `git add handoffs/`
5. `git add` remaining untracked files
6. `git commit -m "chore: Track previously untracked files including frontend"`
7. `git push`

**Do this FIRST before any fixes.**

---

### Question 2: v1.3.0 Scope ‚Äî Re-scope?

**DECISION: YES ‚Äî Re-scope v1.3.0**

**Original v1.3.0 Scope** (what we thought):
- ‚úÖ Lead Sheet Analysis
- ‚úÖ Roman numeral analysis
- ‚úÖ Key detection
- ‚ùå Quiz UI
- ‚ùå Progress dashboard
- ‚ùå Audio playback

**Revised v1.3.0 Scope** (actual deliverable):

| Feature | Status | v1.3.0? |
|---------|--------|---------|
| Bug fixes (router, chords) | ‚úÖ Done | ‚úÖ Yes |
| Lead Sheet Analysis backend | ‚úÖ Done | ‚úÖ Yes |
| Roman numeral display | ‚ö†Ô∏è Needs fix | ‚úÖ Yes (with fix) |
| Key detection display | ‚ö†Ô∏è Needs visibility | ‚úÖ Yes (minor fix) |
| Basic navigation | ‚ùå Missing | ‚úÖ Yes (add nav bar) |
| Quiz UI | ‚ùå Not built | ‚ùå **Move to v1.4.0** |
| Progress dashboard | ‚ùå Not built | ‚ùå **Move to v1.4.0** |
| Audio playback | ‚ùå Not built | ‚ùå **Move to v1.5.0** |

**v1.3.0 Definition of Done (Revised):**
- [x] Router fix verified
- [x] Chords fix verified
- [ ] Roman numeral shows jazz-style notation (not figured bass)
- [ ] Key detection visible in song header (all views)
- [ ] Basic navigation bar on all pages
- [ ] All files committed to git

---

### Question 3: Roman Numeral Format

**DECISION: Jazz-style notation with quality**

**Preferred Format:**
```
Am7 in C major  ‚Üí "vim7" or "vi-7"
Dm7 in C major  ‚Üí "iim7" or "ii-7"
G7 in C major   ‚Üí "V7"
Cmaj7 in C major ‚Üí "Imaj7" or "IŒî7"
Am6 in C major  ‚Üí "vi6" (NOT "i#653")
```

**Implementation:**
```python
# In analysis_service.py
def format_roman_numeral(self, chord, key):
    rn = roman.romanNumeralFromChord(chord, key)
    
    # Get base numeral (i, ii, III, IV, V, vi, vii)
    base = rn.romanNumeral
    
    # Get quality from chord (maj7, m7, 7, dim7, m7b5, 6, etc.)
    quality = self._chord_quality_suffix(chord)
    
    return f"{base}{quality}"

def _chord_quality_suffix(self, chord):
    # Map chord types to jazz suffixes
    # maj7 ‚Üí "maj7" or "Œî7"
    # m7 ‚Üí "m7" or "-7"
    # dom7 ‚Üí "7"
    # dim7 ‚Üí "¬∞7"
    # m7b5 ‚Üí "√∏7"
    # 6 ‚Üí "6"
    # etc.
    ...
```

**Note**: Use ASCII-friendly suffixes (maj7, m7) rather than symbols (Œî, ¬∞) for better compatibility.

---

### Question 4: Audio Priority

**DECISION: Audio is v1.5.0 (NOT v1.3.0 or v1.4.0)**

**Rationale:**
- Audio is 12-16 hours of work
- Requires Tone.js integration from scratch
- Not blocking for core chord analysis functionality
- Quiz and Progress (v1.4.0) provide more immediate value

**Roadmap:**
| Version | Focus | Key Deliverables |
|---------|-------|------------------|
| v1.3.0 | Stability + Analysis | Bug fixes, Roman numerals, navigation |
| v1.4.0 | Interactivity | Quiz UI, Progress dashboard |
| v1.5.0 | Audio | Tone.js chord playback |

---

## Immediate Action Plan

### Phase 1: Git Hygiene (Do First)
```powershell
cd "G:\My Drive\Code\Python\harmonylab"
git add -A
git status  # Review what's being added
git commit -m "chore: Track all files including frontend, analysis service, handoffs"
git push
```

### Phase 2: v1.3.0 Fixes (2-4 hours)

| Task | File | Effort |
|------|------|--------|
| Fix Roman numeral format | `app/services/analysis_service.py` | 1-2 hrs |
| Show key in song header | `frontend/song.html` | 30 min |
| Add nav bar | `frontend/index.html`, `frontend/song.html` | 1-2 hrs |

### Phase 3: Re-deploy & UAT
1. Deploy fixes to Cloud Run
2. Corey re-tests v1.3.0 UAT (reduced scope)
3. Pass/Fail decision

---

## Navigation Bar Specification

Since navigation needs to be added, here's the spec:

**Pages:**
- Home / Songs List (`/`)
- Song Detail (`/song/{id}`)
- Quiz (`/quiz`) ‚Äî v1.4.0, placeholder link for now
- Progress (`/progress`) ‚Äî v1.4.0, placeholder link for now

**Nav Bar HTML:**
```html
<nav class="main-nav">
  <a href="/" class="nav-brand">üéπ HarmonyLab</a>
  <div class="nav-links">
    <a href="/" class="nav-link">Songs</a>
    <a href="/quiz" class="nav-link disabled" title="Coming in v1.4.0">Quiz</a>
    <a href="/progress" class="nav-link disabled" title="Coming in v1.4.0">Progress</a>
  </div>
  <div class="nav-version">v1.3.0</div>
</nav>
```

**Styling:** Match existing dark theme (from UAT checklist CSS variables).

---

## Updated Version Roadmap

| Version | Status | Features |
|---------|--------|----------|
| v1.3.0 | üîÑ IN PROGRESS | Bug fixes, Roman numerals, key display, navigation |
| v1.4.0 | üìã PLANNED | Quiz UI, Progress dashboard (backends ready) |
| v1.5.0 | üìã PLANNED | Tone.js audio playback |
| v2.0.0 | üìã FUTURE | MIDI import UI, manual chord editing |

---

## Definition of Done for v1.3.0 (Final)

- [ ] All files committed to git (no untracked files)
- [ ] Roman numeral shows "vi", "iim7", "V7" format (not figured bass)
- [ ] Key detection visible in song header on all views
- [ ] Navigation bar present on index.html and song.html
- [ ] UAT re-run: Pre-flight, Songs List, Song Detail, Analysis sections pass
- [ ] Quiz/Progress sections marked as "v1.4.0" in UAT (expected to fail)

---

## Response Requested

CC: Proceed with this plan:

1. **Commit all untracked files** ‚Äî Report git status before/after
2. **Fix Roman numeral format** ‚Äî Implement jazz-style notation
3. **Add key to song header** ‚Äî Show in all views
4. **Add navigation bar** ‚Äî Both pages
5. **Deploy and report** ‚Äî New revision number

Send completion report via handoff bridge.

---

*Architectural decisions by Claude.ai (Architect)*
