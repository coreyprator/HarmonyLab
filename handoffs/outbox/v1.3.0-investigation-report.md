# [HarmonyLab] üîµ v1.3.0 UAT Investigation Report

> **From**: Claude Code (Command Center)
> **To**: Claude.ai (Architect)
> **Project**: üîµ HarmonyLab
> **Task**: v1.3.0-investigation-report
> **Timestamp**: 2026-02-07T13:35:00Z
> **Type**: Investigation Report

---

## Executive Summary

| Issue | Root Cause | Status |
|-------|------------|--------|
| Audio playback "regression" | **Never implemented** ‚Äî was only in design docs | NOT A REGRESSION |
| Quiz feature missing | **Backend exists, no frontend** ‚Äî API complete, UI never built | PARTIAL IMPLEMENTATION |
| No main navigation | **Minimal frontend** ‚Äî only back link exists | DESIGN GAP |
| Roman numeral "i#653" | **music21 figured bass output** ‚Äî library returns full figuration | CODE FIX NEEDED |

---

## Issue 1: Audio Playback "Regression"

### Finding: NOT A REGRESSION ‚Äî NEVER IMPLEMENTED

**Evidence:**
- Searched entire codebase for: `Tone|AudioContext|playNote|playChord|WebAudio`
- Found: **0 actual code files** ‚Äî only documentation files reference audio
- Audio references in docs:
  - `HarmonyLab-Kickoff.md` lines 351, 404-513 ‚Äî Tone.js *design specification*
  - `ROADMAP.md` ‚Äî "Phase 2" planned feature
  - `HARMONYLAB-SPRINT2-HANDOFF.md` line 369 ‚Äî listed as future work

**Root Cause:**
Audio playback was **planned** in the design phase but **never implemented**. The user's memory of "it used to work" may be:
- Confusion with another app
- Expectation from design review rather than working feature
- A local prototype that was never committed

**Files Checked:**
- `frontend/song.html` ‚Äî No audio code present
- `frontend/index.html` ‚Äî No audio code present
- No Tone.js imports anywhere in codebase
- No Web Audio API usage anywhere

**Conclusion:** This is a **missing feature**, not a regression.

---

## Issue 2: Quiz Feature Missing from UI

### Finding: BACKEND EXISTS, FRONTEND NOT BUILT

**Backend Status: FULLY IMPLEMENTED**

| Endpoint | Status | File |
|----------|--------|------|
| `POST /api/v1/quiz/generate` | Exists | `app/api/routes/quiz.py:17` |
| `POST /api/v1/quiz/submit` | Exists | `app/api/routes/quiz.py:111` |
| `GET /api/v1/quiz/attempts` | Exists | `app/api/routes/quiz.py:195` |
| `GET /api/v1/quiz/attempts/{id}` | Exists | `app/api/routes/quiz.py:243` |

The quiz.py file has **282 lines** of working code with:
- Quiz generation with configurable blank percentage
- Answer submission and scoring
- Progress tracking integration
- Quiz attempt history

**Frontend Status: NOT BUILT**

- `frontend/index.html` ‚Äî Songs list only, no quiz UI
- `frontend/song.html` ‚Äî Chord analysis only, no quiz button/modal
- No quiz.html or quiz component exists

**Root Cause:** Quiz backend was built in Sprint 2 but the corresponding frontend UI was never created.

---

## Issue 3: Progress Tracking Missing

### Finding: SAME AS QUIZ ‚Äî BACKEND EXISTS, NO FRONTEND

**Backend Status: FULLY IMPLEMENTED**

| Endpoint | Status | File |
|----------|--------|------|
| `GET /api/v1/progress/` | Exists | `app/api/routes/progress.py:15` |
| `GET /api/v1/progress/song/{id}` | Exists | `app/api/routes/progress.py:49` |
| `POST /api/v1/progress/song/{id}` | Exists | `app/api/routes/progress.py:97` |
| `GET /api/v1/progress/stats` | Exists | `app/api/routes/progress.py:194` |

The progress.py file has **242 lines** of working code with:
- Mastery level tracking (0-5)
- Weighted accuracy averaging
- Practice session counting
- Aggregate statistics

**Frontend Status: NOT BUILT**

No UI shows progress or calls these endpoints.

---

## Issue 4: No Main Navigation

### Finding: MINIMAL FRONTEND DESIGN

**Current State:**

| Page | Navigation Elements |
|------|---------------------|
| `index.html` | None ‚Äî no nav bar |
| `song.html` | Back link (`‚Üê Songs`) only |

**Missing:**
- No nav bar/menu
- No breadcrumbs beyond back link
- No way to access quiz, progress, or settings

**Root Cause:** Frontend was built as minimal MVP. Navigation architecture was not implemented.

---

## Issue 5: Roman Numeral "i#653" for Am6

### Finding: music21 FIGURED BASS OUTPUT

**The Problem:**
```python
# In analysis_service.py line 76
c = harmony.ChordSymbol(symbol)
rn = roman.romanNumeralFromChord(c, self.current_key)
# rn.figure returns figured bass notation like "i#653"
```

**Root Cause:**
music21's `romanNumeralFromChord().figure` property returns **full figured bass notation** for extended chords. For Am6:
- `i` = minor tonic (if key is A)
- `#653` = figured bass for chord extensions/inversions

This is technically correct in figured bass but **not what jazz musicians expect**.

**Expected Behavior:**
Jazz musicians expect simplified Roman numerals:
- Am6 in C major ‚Üí "vi" or "vi6"
- Am6 in A minor ‚Üí "i" or "i6"
- NOT "i#653" which is baroque figured bass

**Fix Required:**
Modify `analysis_service.py` to:
1. Use `rn.romanNumeral` instead of `rn.figure` for basic numeral
2. Add quality suffix manually (maj7, m7, 7, etc.)
3. Or strip figured bass extensions with regex

**Proposed Fix:**
```python
# Instead of:
return rn.figure

# Use:
base = rn.romanNumeral  # Just "i", "IV", "V" etc.
quality = self._get_quality_suffix(c)  # "maj7", "m7", "6" etc.
return f"{base}{quality}"
```

---

## Issue 6: Key Center Not Visible

### Finding: IMPLEMENTED BUT REQUIRES ANALYSIS VIEW

**Current State:**
- Key detection IS implemented (`analysis_service.py:54`)
- Key IS displayed in frontend (`song.html:309`)
- BUT requires clicking "Analysis" radio button first
- Not shown in default "Chords" view

**Fix Recommendation:**
Show detected key in song header regardless of view mode.

---

## Uncommitted Changes

**Critical:** There are significant uncommitted changes that may explain gaps:

```
Modified (12 files):
- CLAUDE.md
- Dockerfile
- app/api/routes/{chords,measures,progress,quiz,sections,songs,vocabulary}.py
- app/db/connection.py
- config/settings.py
- main.py

Untracked (7 items):
- HarmonyLab_LeadSheet_Analysis_Design.md
- HarmonyLab_Sprint_Analysis_v1.3.0.md
- app/api/routes/analysis.py          ‚Üê Analysis routes!
- app/migrations.py
- app/services/analysis_service.py    ‚Üê Analysis service!
- frontend/                           ‚Üê Entire frontend folder!
- handoffs/
```

**The entire frontend folder is UNTRACKED!** This might mean the deployed frontend differs from the local development version.

---

## Timeline Estimates

| Issue | Fix Type | Estimated Hours |
|-------|----------|-----------------|
| Roman numeral fix | Code change in analysis_service.py | 1-2 hours |
| Basic navigation | Add nav bar to song.html + index.html | 2-3 hours |
| Quiz UI | Build quiz.html with modal/forms | 6-8 hours |
| Progress dashboard | Build progress.html with charts | 4-6 hours |
| Audio playback (Tone.js) | Full implementation from design | 12-16 hours |

**Immediate (to unblock v1.3.0):** 4-6 hours
**Full feature completion:** 24-35 hours

---

## Recommendations

### Immediate Actions (Required for v1.3.0)

1. **Commit current changes** ‚Äî Untracked frontend is risky
2. **Fix Roman numeral output** ‚Äî Use romanNumeral instead of figure
3. **Add minimal navigation** ‚Äî At least a consistent nav bar

### Defer to Sprint 2

4. **Quiz frontend** ‚Äî Backend is ready
5. **Progress dashboard** ‚Äî Backend is ready
6. **Improved UX** ‚Äî Dropdowns for chord editing

### Defer to Sprint 3+

7. **Audio playback** ‚Äî Major new feature, needs Tone.js integration

---

## Questions Back to Architect

1. **Commit strategy:** Should I commit the untracked files before any fixes?
2. **v1.3.0 scope:** With these findings, should we re-scope v1.3.0 to exclude quiz/progress UI?
3. **Roman numeral format:** What's the preferred output format? Just degree (vi) or with quality (vi6, vim7)?
4. **Audio priority:** Is Tone.js audio a v1.3.0 requirement or can it be Sprint 2+?

---

*Investigation completed by Claude Code (Command Center)*
