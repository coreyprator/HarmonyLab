<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîµ HarmonyLab v1.8.0 ‚Äî UAT Checklist</title>
    <style>
        :root {
            --bg-primary: #1a1a2e;
            --bg-secondary: #252538;
            --accent-green: #22c55e;
            --accent-success: #22c55e;
            --accent-danger: #ef4444;
            --accent-warning: #f59e0b;
            --text-primary: #e5e5e5;
            --text-muted: #9ca3af;
            --border-color: #3a3a52;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
        }

        header {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 24px;
        }

        header h1 { font-size: 1.4rem; margin-bottom: 8px; }
        header p { opacity: 0.9; font-size: 0.9rem; }

        .meta {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            margin-top: 12px;
            font-size: 0.85rem;
        }

        .meta span {
            background: rgba(255,255,255,0.15);
            padding: 4px 10px;
            border-radius: 4px;
        }

        .handoff-refs {
            background: #1e2a3f;
            border: 1px solid #3b82f6;
            border-radius: 8px;
            padding: 14px 18px;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .handoff-refs strong { color: #93c5fd; }
        .handoff-refs code {
            background: #0f172a;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.85rem;
        }

        .url-link {
            display: block;
            background: #0f172a;
            padding: 10px 14px;
            border-radius: 6px;
            margin: 0 0 20px 0;
            font-family: monospace;
            font-size: 0.85rem;
        }

        .url-link a { color: #4ade80; text-decoration: none; }
        .url-link a:hover { text-decoration: underline; }

        .autosave-banner {
            background: #1e3a1e;
            border: 1px solid #22c55e;
            border-radius: 8px;
            padding: 10px 16px;
            margin-bottom: 20px;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .autosave-banner .save-status { color: #4ade80; }
        .autosave-banner .save-time { color: var(--text-muted); font-size: 0.8rem; }

        section {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 16px;
        }

        section h2 {
            color: #60a5fa;
            font-size: 1.1rem;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid #3b82f6;
        }

        .section-note {
            background: #1e1e32;
            padding: 10px 14px;
            border-radius: 6px;
            margin-bottom: 16px;
            font-size: 0.9rem;
            border-left: 3px solid #3b82f6;
        }

        .test-item {
            padding: 16px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .test-item:last-child { border-bottom: none; }

        .test-row {
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .test-content { flex: 1; }

        .test-label {
            font-weight: 500;
            display: block;
            margin-bottom: 4px;
        }

        .test-id {
            font-family: monospace;
            background: #3a3a52;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-right: 8px;
        }

        .expected {
            color: #a78bfa;
            font-size: 0.85rem;
            font-style: italic;
        }

        .test-buttons { display: flex; gap: 6px; }

        .btn {
            padding: 6px 14px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85rem;
            transition: all 0.15s;
        }

        .btn-pass { background: #166534; color: #bbf7d0; }
        .btn-pass:hover, .btn-pass.selected { background: var(--accent-success); color: white; }

        .btn-fail { background: #991b1b; color: #fecaca; }
        .btn-fail:hover, .btn-fail.selected { background: var(--accent-danger); color: white; }

        .btn-skip { background: #374151; color: #9ca3af; }
        .btn-skip:hover, .btn-skip.selected { background: #6b7280; color: white; }

        .test-item.passed .test-label { color: #4ade80; }
        .test-item.failed .test-label { color: #f87171; }
        .test-item.skipped .test-label { color: #9ca3af; }

        .notes-container { margin-top: 10px; }

        .notes-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .notes-label::before { content: "üìù"; font-size: 0.9rem; }

        .notes-input {
            width: 100%;
            padding: 8px 10px;
            background: #1e1e32;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.9rem;
            resize: vertical;
            min-height: 40px;
            transition: border-color 0.15s;
        }

        .notes-input:focus { outline: none; border-color: #4ade80; }
        .notes-input::placeholder { color: #6b7280; }
        .notes-input:not(:placeholder-shown) { border-color: #3b82f6; background: #1e2a3f; }
        .test-item.failed .notes-input { border-color: #f87171; }
        .test-item.passed .notes-input:not(:placeholder-shown) { border-color: #4ade80; }

        .summary {
            background: #1e1e32;
            border: 2px solid #3b82f6;
            border-radius: 8px;
            padding: 20px;
            margin-top: 24px;
        }

        .summary h3 { margin-bottom: 16px; }

        .summary-stats {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .stat {
            padding: 12px 20px;
            border-radius: 6px;
            font-weight: bold;
            text-align: center;
        }

        .stat.total { background: #3b82f6; }
        .stat.passed { background: #166534; }
        .stat.failed { background: var(--accent-danger); }
        .stat.skipped { background: #6b7280; }
        .stat.notes { background: #6366f1; }

        .overall-result {
            padding: 16px;
            border-radius: 8px;
            text-align: center;
            margin-top: 16px;
        }

        .overall-result.pending { background: #374151; border: 2px dashed #6b7280; }
        .overall-result.pass { background: #166534; border: 2px solid var(--accent-success); }
        .overall-result.partial { background: #78350f; border: 2px solid var(--accent-warning); }
        .overall-result.fail { background: #991b1b; border: 2px solid var(--accent-danger); }

        .overall-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        .overall-btn {
            padding: 10px 24px;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
        }

        .overall-btn.approve { background: var(--accent-success); color: white; }
        .overall-btn.partial { background: var(--accent-warning); color: white; }
        .overall-btn.reject { background: var(--accent-danger); color: white; }

        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 16px;
        }

        .copy-btn, .submit-btn, .gcs-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .copy-btn { background: var(--accent-green); color: white; }
        .copy-btn:hover { background: #16a34a; }
        .submit-btn { background: #3b82f6; color: white; }
        .submit-btn:hover { background: #2563eb; }
        .submit-btn:disabled { background: #6b7280; cursor: not-allowed; }
        .gcs-btn { background: #8b5cf6; color: white; }
        .gcs-btn:hover { background: #7c3aed; }

        .submit-result {
            margin-top: 12px;
            padding: 12px;
            border-radius: 6px;
            display: none;
        }
        .submit-result.success { background: #166534; border: 1px solid #22c55e; display: block; }
        .submit-result.error { background: #991b1b; border: 1px solid #ef4444; display: block; }
        .submit-result a { color: #4ade80; }

        .config-section {
            background: #1e3a5f;
            border: 1px solid #3b82f6;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            align-items: center;
        }

        .config-field { display: flex; flex-direction: column; gap: 4px; }
        .config-field label { font-size: 0.8rem; color: #93c5fd; }
        .config-field input {
            background: #0f172a;
            border: 1px solid #3b82f6;
            border-radius: 4px;
            padding: 6px 10px;
            color: white;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <header>
        <h1>üîµ HarmonyLab v1.8.0 ‚Äî UAT Checklist</h1>
        <p>User Acceptance Testing ‚Äî Critical Bug Fixes from UAT v1.7.0</p>
        <div class="meta">
            <span>Template: v2.2</span>
            <span>Project: HarmonyLab</span>
            <span>Version: 1.8.0</span>
            <span id="test-date"></span>
        </div>
    </header>

    <div class="handoff-refs">
        <strong>Handoff References:</strong> <code>HO-M2N3</code>
        <br><strong>Bugs Fixed:</strong> MIDI Import 500, Quiz Count Wrong, Blank Questions, Quiz Submit 422, Version Mismatch
        <br><strong>Commits:</strong> <code>e700401</code>, <code>b168473</code>, <code>7dbf9fa</code>
    </div>

    <div class="url-link">
        <a href="https://harmonylab.rentyourcio.com/" target="_blank">https://harmonylab.rentyourcio.com/</a>
    </div>

    <!-- Auto-save indicator -->
    <div class="autosave-banner">
        <span class="save-status" id="save-status">üíæ Auto-save: active</span>
        <span class="save-time" id="save-time">Not saved yet</span>
    </div>

    <!-- MetaPM Config -->
    <div class="config-section">
        <div class="config-field">
            <label>Project Name</label>
            <input type="text" id="config-project" value="HarmonyLab" placeholder="e.g. HarmonyLab">
        </div>
        <div class="config-field">
            <label>Version</label>
            <input type="text" id="config-version" value="1.8.0" placeholder="e.g. 1.8.0">
        </div>
        <div class="config-field">
            <label>Feature</label>
            <input type="text" id="config-feature" value="HO-M2N3 Bug Fixes" placeholder="e.g. Bug Fixes">
        </div>
    </div>

    <!-- ============================================= -->
    <!-- TEST SECTIONS -->
    <!-- ============================================= -->

    <!-- Section 1: MIDI Import -->
    <section>
        <h2>1. MIDI Import (BUG 2 ‚Äî P0)</h2>
        <div class="section-note">
            Core functionality. MIDI Import was returning 500 (Internal Server Error) due to dict key access bug in imports.py.
            Root cause: <code>result[0][0]</code> ‚Üí fixed to <code>result[0]['id']</code> in 3 locations.
        </div>

        <div class="test-item" data-test="MI-01">
            <div class="test-row">
                <div class="test-content">
                    <span class="test-id">MI-01</span>
                    <span class="test-label">Navigate to Songs page, click "+ Add Song"</span>
                    <span class="expected">‚Üí Modal opens with "Import Song from MIDI" header. No "Manual Entry" tab.</span>
                </div>
                <div class="test-buttons">
                    <button class="btn btn-pass" onclick="setResult(this, 'pass')">‚úì Pass</button>
                    <button class="btn btn-fail" onclick="setResult(this, 'fail')">‚úó Fail</button>
                    <button class="btn btn-skip" onclick="setResult(this, 'skip')">‚Äî Skip</button>
                </div>
            </div>
            <div class="notes-container">
                <div class="notes-label">Notes / Feedback</div>
                <textarea class="notes-input" placeholder="Add context, feedback, or observations..."></textarea>
            </div>
        </div>

        <div class="test-item" data-test="MI-02">
            <div class="test-row">
                <div class="test-content">
                    <span class="test-id">MI-02</span>
                    <span class="test-label">Select a .mid file ‚Üí Preview loads</span>
                    <span class="expected">‚Üí Shows detected title, tempo, time signature, measure count, chord count</span>
                </div>
                <div class="test-buttons">
                    <button class="btn btn-pass" onclick="setResult(this, 'pass')">‚úì Pass</button>
                    <button class="btn btn-fail" onclick="setResult(this, 'fail')">‚úó Fail</button>
                    <button class="btn btn-skip" onclick="setResult(this, 'skip')">‚Äî Skip</button>
                </div>
            </div>
            <div class="notes-container">
                <div class="notes-label">Notes / Feedback</div>
                <textarea class="notes-input" placeholder="Add context, feedback, or observations..."></textarea>
            </div>
        </div>

        <div class="test-item" data-test="MI-03">
            <div class="test-row">
                <div class="test-content">
                    <span class="test-id">MI-03</span>
                    <span class="test-label">Chord preview grid displays first ~20 extracted chords (BUG 3)</span>
                    <span class="expected">‚Üí Grid shows chips like "m1:Cmaj7", "m2:Dm7", etc.</span>
                </div>
                <div class="test-buttons">
                    <button class="btn btn-pass" onclick="setResult(this, 'pass')">‚úì Pass</button>
                    <button class="btn btn-fail" onclick="setResult(this, 'fail')">‚úó Fail</button>
                    <button class="btn btn-skip" onclick="setResult(this, 'skip')">‚Äî Skip</button>
                </div>
            </div>
            <div class="notes-container">
                <div class="notes-label">Notes / Feedback</div>
                <textarea class="notes-input" placeholder="Add context, feedback, or observations..."></textarea>
            </div>
        </div>

        <div class="test-item" data-test="MI-04">
            <div class="test-row">
                <div class="test-content">
                    <span class="test-id">MI-04</span>
                    <span class="test-label">Fill in title/composer/genre, click "Import Song"</span>
                    <span class="expected">‚Üí Import succeeds (no 500 error), redirects to song detail page</span>
                </div>
                <div class="test-buttons">
                    <button class="btn btn-pass" onclick="setResult(this, 'pass')">‚úì Pass</button>
                    <button class="btn btn-fail" onclick="setResult(this, 'fail')">‚úó Fail</button>
                    <button class="btn btn-skip" onclick="setResult(this, 'skip')">‚Äî Skip</button>
                </div>
            </div>
            <div class="notes-container">
                <div class="notes-label">Notes / Feedback</div>
                <textarea class="notes-input" placeholder="Add context, feedback, or observations..."></textarea>
            </div>
        </div>

        <div class="test-item" data-test="MI-05">
            <div class="test-row">
                <div class="test-content">
                    <span class="test-id">MI-05</span>
                    <span class="test-label">Song detail page shows imported chords in grid</span>
                    <span class="expected">‚Üí Measures and chords display correctly with proper symbols</span>
                </div>
                <div class="test-buttons">
                    <button class="btn btn-pass" onclick="setResult(this, 'pass')">‚úì Pass</button>
                    <button class="btn btn-fail" onclick="setResult(this, 'fail')">‚úó Fail</button>
                    <button class="btn btn-skip" onclick="setResult(this, 'skip')">‚Äî Skip</button>
                </div>
            </div>
            <div class="notes-container">
                <div class="notes-label">Notes / Feedback</div>
                <textarea class="notes-input" placeholder="Add context, feedback, or observations..."></textarea>
            </div>
        </div>
    </section>

    <!-- Section 2: Edit Chord -->
    <section>
        <h2>2. Edit Chord Modal (BUG 4 ‚Äî P0)</h2>
        <div class="section-note">
            Chord editing must show Root and Quality dropdowns, not just a disabled text field.
            HTML already has the dropdowns ‚Äî verify they render correctly after fresh deploy.
        </div>

        <div class="test-item" data-test="EC-01">
            <div class="test-row">
                <div class="test-content">
                    <span class="test-id">EC-01</span>
                    <span class="test-label">Click any chord in Chords view ‚Üí Edit modal opens</span>
                    <span class="expected">‚Üí Modal shows "Edit Chord" header with Current, Root, Quality, and New Chord fields</span>
                </div>
                <div class="test-buttons">
                    <button class="btn btn-pass" onclick="setResult(this, 'pass')">‚úì Pass</button>
                    <button class="btn btn-fail" onclick="setResult(this, 'fail')">‚úó Fail</button>
                    <button class="btn btn-skip" onclick="setResult(this, 'skip')">‚Äî Skip</button>
                </div>
            </div>
            <div class="notes-container">
                <div class="notes-label">Notes / Feedback</div>
                <textarea class="notes-input" placeholder="Add context, feedback, or observations..."></textarea>
            </div>
        </div>

        <div class="test-item" data-test="EC-02">
            <div class="test-row">
                <div class="test-content">
                    <span class="test-id">EC-02</span>
                    <span class="test-label">Root dropdown shows all 17 note options (C, C#, Db, D, ... B)</span>
                    <span class="expected">‚Üí Dropdown is populated and selectable, pre-set to chord's current root</span>
                </div>
                <div class="test-buttons">
                    <button class="btn btn-pass" onclick="setResult(this, 'pass')">‚úì Pass</button>
                    <button class="btn btn-fail" onclick="setResult(this, 'fail')">‚úó Fail</button>
                    <button class="btn btn-skip" onclick="setResult(this, 'skip')">‚Äî Skip</button>
                </div>
            </div>
            <div class="notes-container">
                <div class="notes-label">Notes / Feedback</div>
                <textarea class="notes-input" placeholder="Add context, feedback, or observations..."></textarea>
            </div>
        </div>

        <div class="test-item" data-test="EC-03">
            <div class="test-row">
                <div class="test-content">
                    <span class="test-id">EC-03</span>
                    <span class="test-label">Quality dropdown shows all 20 options (Major, m, 7, maj7, m7, dim, ...)</span>
                    <span class="expected">‚Üí Dropdown populated, pre-set to chord's current quality</span>
                </div>
                <div class="test-buttons">
                    <button class="btn btn-pass" onclick="setResult(this, 'pass')">‚úì Pass</button>
                    <button class="btn btn-fail" onclick="setResult(this, 'fail')">‚úó Fail</button>
                    <button class="btn btn-skip" onclick="setResult(this, 'skip')">‚Äî Skip</button>
                </div>
            </div>
            <div class="notes-container">
                <div class="notes-label">Notes / Feedback</div>
                <textarea class="notes-input" placeholder="Add context, feedback, or observations..."></textarea>
            </div>
        </div>

        <div class="test-item" data-test="EC-04">
            <div class="test-row">
                <div class="test-content">
                    <span class="test-id">EC-04</span>
                    <span class="test-label">Changing root/quality updates "New Chord" preview live</span>
                    <span class="expected">‚Üí Preview updates instantly as dropdowns change (e.g., "Dm7" ‚Üí "Ebmaj7")</span>
                </div>
                <div class="test-buttons">
                    <button class="btn btn-pass" onclick="setResult(this, 'pass')">‚úì Pass</button>
                    <button class="btn btn-fail" onclick="setResult(this, 'fail')">‚úó Fail</button>
                    <button class="btn btn-skip" onclick="setResult(this, 'skip')">‚Äî Skip</button>
                </div>
            </div>
            <div class="notes-container">
                <div class="notes-label">Notes / Feedback</div>
                <textarea class="notes-input" placeholder="Add context, feedback, or observations..."></textarea>
            </div>
        </div>

        <div class="test-item" data-test="EC-05">
            <div class="test-row">
                <div class="test-content">
                    <span class="test-id">EC-05</span>
                    <span class="test-label">Click "Save" ‚Üí Chord updates in grid</span>
                    <span class="expected">‚Üí Grid shows new chord symbol, no errors in console</span>
                </div>
                <div class="test-buttons">
                    <button class="btn btn-pass" onclick="setResult(this, 'pass')">‚úì Pass</button>
                    <button class="btn btn-fail" onclick="setResult(this, 'fail')">‚úó Fail</button>
                    <button class="btn btn-skip" onclick="setResult(this, 'skip')">‚Äî Skip</button>
                </div>
            </div>
            <div class="notes-container">
                <div class="notes-label">Notes / Feedback</div>
                <textarea class="notes-input" placeholder="Add context, feedback, or observations..."></textarea>
            </div>
        </div>
    </section>

    <!-- Section 3: Quiz -->
    <section>
        <h2>3. Quiz (BUGs 5, 6, 7 ‚Äî P0)</h2>
        <div class="section-note">
            Quiz had 3 bugs: wrong question count (BUG 5), blank first question (BUG 6), and submit 422 (BUG 7).
            Fixes: num_questions used directly, empty chord_symbol filtered out, answer count mismatch resolved.
        </div>

        <div class="test-item" data-test="QZ-01">
            <div class="test-row">
                <div class="test-content">
                    <span class="test-id">QZ-01</span>
                    <span class="test-label">Navigate to Quiz, select a song, select "5 questions"</span>
                    <span class="expected">‚Üí Quiz setup shows song selected and 5 questions</span>
                </div>
                <div class="test-buttons">
                    <button class="btn btn-pass" onclick="setResult(this, 'pass')">‚úì Pass</button>
                    <button class="btn btn-fail" onclick="setResult(this, 'fail')">‚úó Fail</button>
                    <button class="btn btn-skip" onclick="setResult(this, 'skip')">‚Äî Skip</button>
                </div>
            </div>
            <div class="notes-container">
                <div class="notes-label">Notes / Feedback</div>
                <textarea class="notes-input" placeholder="Add context, feedback, or observations..."></textarea>
            </div>
        </div>

        <div class="test-item" data-test="QZ-02">
            <div class="test-row">
                <div class="test-content">
                    <span class="test-id">QZ-02</span>
                    <span class="test-label">Start quiz ‚Üí Shows "Question 1 of 5" (not 1 of 11)</span>
                    <span class="expected">‚Üí Total questions matches selected count (5)</span>
                </div>
                <div class="test-buttons">
                    <button class="btn btn-pass" onclick="setResult(this, 'pass')">‚úì Pass</button>
                    <button class="btn btn-fail" onclick="setResult(this, 'fail')">‚úó Fail</button>
                    <button class="btn btn-skip" onclick="setResult(this, 'skip')">‚Äî Skip</button>
                </div>
            </div>
            <div class="notes-container">
                <div class="notes-label">Notes / Feedback</div>
                <textarea class="notes-input" placeholder="Add context, feedback, or observations..."></textarea>
            </div>
        </div>

        <div class="test-item" data-test="QZ-03">
            <div class="test-row">
                <div class="test-content">
                    <span class="test-id">QZ-03</span>
                    <span class="test-label">First question shows a non-blank chord (not empty)</span>
                    <span class="expected">‚Üí All questions show actual chord options, no blank/empty chords</span>
                </div>
                <div class="test-buttons">
                    <button class="btn btn-pass" onclick="setResult(this, 'pass')">‚úì Pass</button>
                    <button class="btn btn-fail" onclick="setResult(this, 'fail')">‚úó Fail</button>
                    <button class="btn btn-skip" onclick="setResult(this, 'skip')">‚Äî Skip</button>
                </div>
            </div>
            <div class="notes-container">
                <div class="notes-label">Notes / Feedback</div>
                <textarea class="notes-input" placeholder="Add context, feedback, or observations..."></textarea>
            </div>
        </div>

        <div class="test-item" data-test="QZ-04">
            <div class="test-row">
                <div class="test-content">
                    <span class="test-id">QZ-04</span>
                    <span class="test-label">Answer all 5 questions ‚Üí Results screen appears</span>
                    <span class="expected">‚Üí Shows score, correct/wrong count, average time</span>
                </div>
                <div class="test-buttons">
                    <button class="btn btn-pass" onclick="setResult(this, 'pass')">‚úì Pass</button>
                    <button class="btn btn-fail" onclick="setResult(this, 'fail')">‚úó Fail</button>
                    <button class="btn btn-skip" onclick="setResult(this, 'skip')">‚Äî Skip</button>
                </div>
            </div>
            <div class="notes-container">
                <div class="notes-label">Notes / Feedback</div>
                <textarea class="notes-input" placeholder="Add context, feedback, or observations..."></textarea>
            </div>
        </div>

        <div class="test-item" data-test="QZ-05">
            <div class="test-row">
                <div class="test-content">
                    <span class="test-id">QZ-05</span>
                    <span class="test-label">No 422 error in console after quiz completion</span>
                    <span class="expected">‚Üí Open DevTools Console: no 422 errors on /api/v1/quiz/submit</span>
                </div>
                <div class="test-buttons">
                    <button class="btn btn-pass" onclick="setResult(this, 'pass')">‚úì Pass</button>
                    <button class="btn btn-fail" onclick="setResult(this, 'fail')">‚úó Fail</button>
                    <button class="btn btn-skip" onclick="setResult(this, 'skip')">‚Äî Skip</button>
                </div>
            </div>
            <div class="notes-container">
                <div class="notes-label">Notes / Feedback</div>
                <textarea class="notes-input" placeholder="Add context, feedback, or observations..."></textarea>
            </div>
        </div>

        <div class="test-item" data-test="QZ-06">
            <div class="test-row">
                <div class="test-content">
                    <span class="test-id">QZ-06</span>
                    <span class="test-label">Try quiz with 10 and 15 questions to verify counts</span>
                    <span class="expected">‚Üí "Question 1 of 10" and "Question 1 of 15" respectively</span>
                </div>
                <div class="test-buttons">
                    <button class="btn btn-pass" onclick="setResult(this, 'pass')">‚úì Pass</button>
                    <button class="btn btn-fail" onclick="setResult(this, 'fail')">‚úó Fail</button>
                    <button class="btn btn-skip" onclick="setResult(this, 'skip')">‚Äî Skip</button>
                </div>
            </div>
            <div class="notes-container">
                <div class="notes-label">Notes / Feedback</div>
                <textarea class="notes-input" placeholder="Add context, feedback, or observations..."></textarea>
            </div>
        </div>
    </section>

    <!-- Section 4: Version & UI -->
    <section>
        <h2>4. Version Consistency & UI (ISSUES 8, 9 ‚Äî P2)</h2>
        <div class="section-note">
            All pages should show v1.8.0. Manual Add Song tab should not exist.
        </div>

        <div class="test-item" data-test="VU-01">
            <div class="test-row">
                <div class="test-content">
                    <span class="test-id">VU-01</span>
                    <span class="test-label">Login page shows v1.8.0</span>
                    <span class="expected">‚Üí Bottom of login page shows "v1.8.0"</span>
                </div>
                <div class="test-buttons">
                    <button class="btn btn-pass" onclick="setResult(this, 'pass')">‚úì Pass</button>
                    <button class="btn btn-fail" onclick="setResult(this, 'fail')">‚úó Fail</button>
                    <button class="btn btn-skip" onclick="setResult(this, 'skip')">‚Äî Skip</button>
                </div>
            </div>
            <div class="notes-container">
                <div class="notes-label">Notes / Feedback</div>
                <textarea class="notes-input" placeholder="Add context, feedback, or observations..."></textarea>
            </div>
        </div>

        <div class="test-item" data-test="VU-02">
            <div class="test-row">
                <div class="test-content">
                    <span class="test-id">VU-02</span>
                    <span class="test-label">Songs page nav bar shows v1.8.0</span>
                    <span class="expected">‚Üí Nav bar version badge reads "v1.8.0"</span>
                </div>
                <div class="test-buttons">
                    <button class="btn btn-pass" onclick="setResult(this, 'pass')">‚úì Pass</button>
                    <button class="btn btn-fail" onclick="setResult(this, 'fail')">‚úó Fail</button>
                    <button class="btn btn-skip" onclick="setResult(this, 'skip')">‚Äî Skip</button>
                </div>
            </div>
            <div class="notes-container">
                <div class="notes-label">Notes / Feedback</div>
                <textarea class="notes-input" placeholder="Add context, feedback, or observations..."></textarea>
            </div>
        </div>

        <div class="test-item" data-test="VU-03">
            <div class="test-row">
                <div class="test-content">
                    <span class="test-id">VU-03</span>
                    <span class="test-label">Health endpoint returns version 1.8.0</span>
                    <span class="expected">‚Üí GET /health returns {"version": "1.8.0"}</span>
                </div>
                <div class="test-buttons">
                    <button class="btn btn-pass" onclick="setResult(this, 'pass')">‚úì Pass</button>
                    <button class="btn btn-fail" onclick="setResult(this, 'fail')">‚úó Fail</button>
                    <button class="btn btn-skip" onclick="setResult(this, 'skip')">‚Äî Skip</button>
                </div>
            </div>
            <div class="notes-container">
                <div class="notes-label">Notes / Feedback</div>
                <textarea class="notes-input" placeholder="Add context, feedback, or observations..."></textarea>
            </div>
        </div>

        <div class="test-item" data-test="VU-04">
            <div class="test-row">
                <div class="test-content">
                    <span class="test-id">VU-04</span>
                    <span class="test-label">Quiz and Progress pages show v1.8.0 in nav</span>
                    <span class="expected">‚Üí Consistent version across all pages</span>
                </div>
                <div class="test-buttons">
                    <button class="btn btn-pass" onclick="setResult(this, 'pass')">‚úì Pass</button>
                    <button class="btn btn-fail" onclick="setResult(this, 'fail')">‚úó Fail</button>
                    <button class="btn btn-skip" onclick="setResult(this, 'skip')">‚Äî Skip</button>
                </div>
            </div>
            <div class="notes-container">
                <div class="notes-label">Notes / Feedback</div>
                <textarea class="notes-input" placeholder="Add context, feedback, or observations..."></textarea>
            </div>
        </div>

        <div class="test-item" data-test="VU-05">
            <div class="test-row">
                <div class="test-content">
                    <span class="test-id">VU-05</span>
                    <span class="test-label">Add Song modal has MIDI Import only ‚Äî no Manual Entry tab</span>
                    <span class="expected">‚Üí Single panel for MIDI upload, no tab switcher</span>
                </div>
                <div class="test-buttons">
                    <button class="btn btn-pass" onclick="setResult(this, 'pass')">‚úì Pass</button>
                    <button class="btn btn-fail" onclick="setResult(this, 'fail')">‚úó Fail</button>
                    <button class="btn btn-skip" onclick="setResult(this, 'skip')">‚Äî Skip</button>
                </div>
            </div>
            <div class="notes-container">
                <div class="notes-label">Notes / Feedback</div>
                <textarea class="notes-input" placeholder="Add context, feedback, or observations..."></textarea>
            </div>
        </div>
    </section>

    <!-- Section 5: Regression -->
    <section>
        <h2>5. Regression ‚Äî Core Features Still Working</h2>
        <div class="section-note">
            Verify that fixes didn't break existing functionality.
        </div>

        <div class="test-item" data-test="RG-01">
            <div class="test-row">
                <div class="test-content">
                    <span class="test-id">RG-01</span>
                    <span class="test-label">Song list loads on home page</span>
                    <span class="expected">‚Üí Songs appear in grid, search and genre filter work</span>
                </div>
                <div class="test-buttons">
                    <button class="btn btn-pass" onclick="setResult(this, 'pass')">‚úì Pass</button>
                    <button class="btn btn-fail" onclick="setResult(this, 'fail')">‚úó Fail</button>
                    <button class="btn btn-skip" onclick="setResult(this, 'skip')">‚Äî Skip</button>
                </div>
            </div>
            <div class="notes-container">
                <div class="notes-label">Notes / Feedback</div>
                <textarea class="notes-input" placeholder="Add context, feedback, or observations..."></textarea>
            </div>
        </div>

        <div class="test-item" data-test="RG-02">
            <div class="test-row">
                <div class="test-content">
                    <span class="test-id">RG-02</span>
                    <span class="test-label">Click a song ‚Üí Song detail page loads with chords</span>
                    <span class="expected">‚Üí Song title, composer, chords grid all display</span>
                </div>
                <div class="test-buttons">
                    <button class="btn btn-pass" onclick="setResult(this, 'pass')">‚úì Pass</button>
                    <button class="btn btn-fail" onclick="setResult(this, 'fail')">‚úó Fail</button>
                    <button class="btn btn-skip" onclick="setResult(this, 'skip')">‚Äî Skip</button>
                </div>
            </div>
            <div class="notes-container">
                <div class="notes-label">Notes / Feedback</div>
                <textarea class="notes-input" placeholder="Add context, feedback, or observations..."></textarea>
            </div>
        </div>

        <div class="test-item" data-test="RG-03">
            <div class="test-row">
                <div class="test-content">
                    <span class="test-id">RG-03</span>
                    <span class="test-label">Analysis view toggle works (Chords ‚Üî Analysis)</span>
                    <span class="expected">‚Üí Switching views shows/hides roman numerals and function colors</span>
                </div>
                <div class="test-buttons">
                    <button class="btn btn-pass" onclick="setResult(this, 'pass')">‚úì Pass</button>
                    <button class="btn btn-fail" onclick="setResult(this, 'fail')">‚úó Fail</button>
                    <button class="btn btn-skip" onclick="setResult(this, 'skip')">‚Äî Skip</button>
                </div>
            </div>
            <div class="notes-container">
                <div class="notes-label">Notes / Feedback</div>
                <textarea class="notes-input" placeholder="Add context, feedback, or observations..."></textarea>
            </div>
        </div>

        <div class="test-item" data-test="RG-04">
            <div class="test-row">
                <div class="test-content">
                    <span class="test-id">RG-04</span>
                    <span class="test-label">Audio playback: click chord ‚Üí hear it play</span>
                    <span class="expected">‚Üí Enable Audio button works, chord plays on click</span>
                </div>
                <div class="test-buttons">
                    <button class="btn btn-pass" onclick="setResult(this, 'pass')">‚úì Pass</button>
                    <button class="btn btn-fail" onclick="setResult(this, 'fail')">‚úó Fail</button>
                    <button class="btn btn-skip" onclick="setResult(this, 'skip')">‚Äî Skip</button>
                </div>
            </div>
            <div class="notes-container">
                <div class="notes-label">Notes / Feedback</div>
                <textarea class="notes-input" placeholder="Add context, feedback, or observations..."></textarea>
            </div>
        </div>

        <div class="test-item" data-test="RG-05">
            <div class="test-row">
                <div class="test-content">
                    <span class="test-id">RG-05</span>
                    <span class="test-label">Progress page loads with stats</span>
                    <span class="expected">‚Üí Shows songs practiced, accuracy, quiz sessions, streak</span>
                </div>
                <div class="test-buttons">
                    <button class="btn btn-pass" onclick="setResult(this, 'pass')">‚úì Pass</button>
                    <button class="btn btn-fail" onclick="setResult(this, 'fail')">‚úó Fail</button>
                    <button class="btn btn-skip" onclick="setResult(this, 'skip')">‚Äî Skip</button>
                </div>
            </div>
            <div class="notes-container">
                <div class="notes-label">Notes / Feedback</div>
                <textarea class="notes-input" placeholder="Add context, feedback, or observations..."></textarea>
            </div>
        </div>
    </section>

    <!-- General Notes Section -->
    <div class="general-notes-section" style="background: #252538; border: 2px solid #8b5cf6; border-radius: 8px; padding: 20px; margin-bottom: 16px;">
        <h2 style="color: #a78bfa; font-size: 1.1rem; margin-bottom: 16px; padding-bottom: 8px; border-bottom: 2px solid #8b5cf6;">General Notes & Observations</h2>
        <div style="background: #1e1e32; padding: 10px 14px; border-radius: 6px; margin-bottom: 16px; font-size: 0.9rem; border-left: 3px solid #8b5cf6;">
            Capture general observations, new feature requests, improvement ideas, or bugs found during testing.
        </div>
        <textarea id="general-notes" class="notes-input" style="min-height: 120px; border-color: #8b5cf6;" placeholder="General observations, feature requests, improvement ideas, bugs found during testing..."></textarea>
    </div>

    <!-- Results Summary -->
    <div class="summary">
        <h3>Results Summary</h3>
        <div class="summary-stats">
            <div class="stat total">Total: <span id="total-count">0</span></div>
            <div class="stat passed">Pass: <span id="pass-count">0</span></div>
            <div class="stat failed">Fail: <span id="fail-count">0</span></div>
            <div class="stat skipped">Skip: <span id="skip-count">0</span></div>
            <div class="stat notes">Notes: <span id="notes-count">0</span></div>
        </div>

        <div class="overall-result pending" id="overall-result">
            <h4>Overall Decision</h4>
            <p style="margin-bottom:12px;opacity:0.8;">Ready for approval?</p>
            <div class="overall-buttons">
                <button class="overall-btn approve" onclick="setOverall('pass')">APPROVED</button>
                <button class="overall-btn partial" onclick="setOverall('partial')">PARTIAL</button>
                <button class="overall-btn reject" onclick="setOverall('fail')">REJECTED</button>
            </div>
        </div>

        <div class="action-buttons">
            <button class="copy-btn" onclick="copyResults()">üìã Copy Results</button>
            <button class="submit-btn" onclick="submitToMetaPM()" id="submit-btn">üì§ Submit to MetaPM</button>
        </div>
        <div class="submit-result" id="submit-result"></div>
    </div>

    <script>
        // ==========================================
        // AUTO-SAVE ENGINE
        // ==========================================
        const STORAGE_KEY = 'uat-harmonylab-v1.8.0-HO-M2N3';
        let autoSaveTimer = null;

        function saveState() {
            const state = {
                savedAt: new Date().toISOString(),
                version: '1.8.0',
                project: 'HarmonyLab',
                handoffId: 'HO-M2N3',
                overallDecision: null,
                testResults: {},
                generalNotes: '',
                configProject: '',
                configVersion: '',
                configFeature: ''
            };

            // Save config fields
            state.configProject = document.getElementById('config-project').value;
            state.configVersion = document.getElementById('config-version').value;
            state.configFeature = document.getElementById('config-feature').value;

            // Save general notes
            state.generalNotes = document.getElementById('general-notes').value;

            // Save overall decision
            const overall = document.getElementById('overall-result');
            if (overall.classList.contains('pass')) state.overallDecision = 'pass';
            else if (overall.classList.contains('partial')) state.overallDecision = 'partial';
            else if (overall.classList.contains('fail')) state.overallDecision = 'fail';

            // Save each test item result + notes
            document.querySelectorAll('.test-item').forEach(item => {
                const key = item.dataset.test;
                if (!key) return;
                let result = null;
                if (item.classList.contains('passed')) result = 'pass';
                else if (item.classList.contains('failed')) result = 'fail';
                else if (item.classList.contains('skipped')) result = 'skip';

                const notes = item.querySelector('.notes-input')?.value || '';
                state.testResults[key] = { result, notes };
            });

            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
                document.getElementById('save-status').textContent = 'üíæ Auto-save: active';
                document.getElementById('save-time').textContent = 'Saved: ' + new Date().toLocaleTimeString();
            } catch (e) {
                console.error('Auto-save failed:', e);
                document.getElementById('save-status').textContent = '‚ö†Ô∏è Auto-save: failed';
            }
        }

        function loadState() {
            try {
                const raw = localStorage.getItem(STORAGE_KEY);
                if (!raw) return false;
                const state = JSON.parse(raw);

                // Restore config
                if (state.configProject) document.getElementById('config-project').value = state.configProject;
                if (state.configVersion) document.getElementById('config-version').value = state.configVersion;
                if (state.configFeature) document.getElementById('config-feature').value = state.configFeature;

                // Restore general notes
                if (state.generalNotes) document.getElementById('general-notes').value = state.generalNotes;

                // Restore test results
                for (const [key, data] of Object.entries(state.testResults || {})) {
                    const item = document.querySelector(`.test-item[data-test="${key}"]`);
                    if (!item) continue;

                    if (data.result) {
                        item.classList.remove('passed', 'failed', 'skipped');
                        if (data.result === 'pass') item.classList.add('passed');
                        else if (data.result === 'fail') item.classList.add('failed');
                        else if (data.result === 'skip') item.classList.add('skipped');

                        // Highlight the correct button
                        const btnClass = data.result === 'pass' ? 'btn-pass' : data.result === 'fail' ? 'btn-fail' : 'btn-skip';
                        const btn = item.querySelector(`.${btnClass}`);
                        if (btn) btn.classList.add('selected');
                    }

                    if (data.notes) {
                        const textarea = item.querySelector('.notes-input');
                        if (textarea) textarea.value = data.notes;
                    }
                }

                // Restore overall decision
                if (state.overallDecision) {
                    setOverall(state.overallDecision);
                }

                updateCounts();

                document.getElementById('save-time').textContent =
                    'Restored from: ' + new Date(state.savedAt).toLocaleString();
                return true;
            } catch (e) {
                console.error('Failed to load saved state:', e);
                return false;
            }
        }

        function scheduleAutoSave() {
            if (autoSaveTimer) clearTimeout(autoSaveTimer);
            autoSaveTimer = setTimeout(saveState, 1000);
        }

        // ==========================================
        // CORE FUNCTIONS
        // ==========================================

        document.getElementById('test-date').textContent = new Date().toLocaleDateString();
        document.getElementById('total-count').textContent = document.querySelectorAll('.test-item').length;

        // Listen for changes on all inputs
        document.querySelectorAll('.notes-input').forEach(input => {
            input.addEventListener('input', () => { updateCounts(); scheduleAutoSave(); });
        });
        document.querySelectorAll('.config-field input').forEach(input => {
            input.addEventListener('input', scheduleAutoSave);
        });

        function setResult(btn, result) {
            const item = btn.closest('.test-item');
            const buttons = item.querySelectorAll('.btn');
            buttons.forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');

            item.classList.remove('passed', 'failed', 'skipped');
            if (result === 'pass') item.classList.add('passed');
            else if (result === 'fail') item.classList.add('failed');
            else item.classList.add('skipped');

            updateCounts();
            scheduleAutoSave();
        }

        function updateCounts() {
            document.getElementById('pass-count').textContent = document.querySelectorAll('.test-item.passed').length;
            document.getElementById('fail-count').textContent = document.querySelectorAll('.test-item.failed').length;
            document.getElementById('skip-count').textContent = document.querySelectorAll('.test-item.skipped').length;

            const notesCount = Array.from(document.querySelectorAll('.test-item .notes-input'))
                .filter(input => input.value.trim().length > 0).length;
            document.getElementById('notes-count').textContent = notesCount;
        }

        function setOverall(result) {
            const container = document.getElementById('overall-result');
            container.classList.remove('pending', 'pass', 'partial', 'fail');
            container.classList.add(result);

            if (result === 'pass') {
                container.innerHTML = '<h4 style="color: #4ade80;">‚úÖ APPROVED</h4><p>UAT complete ‚Äî all critical tests passed.</p>';
            } else if (result === 'partial') {
                container.innerHTML = '<h4 style="color: #f59e0b;">‚ö†Ô∏è PARTIAL APPROVAL</h4><p>Non-critical issues found ‚Äî see notes above.</p>';
            } else {
                container.innerHTML = '<h4 style="color: #f87171;">‚ùå REJECTED ‚Äî NEEDS FIXES</h4><p>Critical failures found ‚Äî see failed tests and notes above.</p>';
            }
            scheduleAutoSave();
        }

        // ==========================================
        // BUILD RESULTS TEXT
        // ==========================================

        function buildResultsText() {
            const project = document.getElementById('config-project').value.trim() || 'HarmonyLab';
            const version = document.getElementById('config-version').value.trim() || '1.8.0';
            const feature = document.getElementById('config-feature').value.trim();
            const passed = document.querySelectorAll('.test-item.passed').length;
            const failed = document.querySelectorAll('.test-item.failed').length;
            const skipped = document.querySelectorAll('.test-item.skipped').length;
            const notesCount = Array.from(document.querySelectorAll('.test-item .notes-input'))
                .filter(input => input.value.trim().length > 0).length;

            let results = `[${project}] v${version} UAT Results\n${'='.repeat(50)}\n`;
            results += `Date: ${new Date().toLocaleString()}\n`;
            results += `Handoff: HO-M2N3\n`;
            if (feature) results += `Feature: ${feature}\n`;
            results += `Summary: ${passed} passed, ${failed} failed, ${skipped} skipped, ${notesCount} with notes\n`;
            results += `${'='.repeat(50)}\n\n`;

            document.querySelectorAll('section').forEach(section => {
                const h2 = section.querySelector('h2');
                if (h2) {
                    results += `${h2.textContent}\n${'-'.repeat(40)}\n`;
                    section.querySelectorAll('.test-item').forEach(item => {
                        const id = item.querySelector('.test-id')?.textContent || '';
                        const label = item.querySelector('.test-label').textContent;
                        const notes = item.querySelector('.notes-input')?.value || '';
                        let sym = '‚óã';
                        if (item.classList.contains('passed')) sym = '‚úì';
                        if (item.classList.contains('failed')) sym = '‚úó';
                        if (item.classList.contains('skipped')) sym = '‚Äî';
                        results += `  ${sym} [${id}] ${label}\n`;
                        if (notes.trim()) results += `      üìù ${notes}\n`;
                    });
                    results += '\n';
                }
            });

            const generalNotes = document.getElementById('general-notes')?.value?.trim();
            if (generalNotes) {
                results += `General Notes & Observations\n${'-'.repeat(40)}\n`;
                results += `${generalNotes}\n\n`;
            }

            const overall = document.getElementById('overall-result');
            if (overall.classList.contains('pass')) results += 'OVERALL: ‚úÖ APPROVED\n';
            else if (overall.classList.contains('partial')) results += 'OVERALL: ‚ö†Ô∏è PARTIAL APPROVAL\n';
            else if (overall.classList.contains('fail')) results += 'OVERALL: ‚ùå REJECTED ‚Äî NEEDS FIXES\n';

            return results;
        }

        // ==========================================
        // COPY RESULTS
        // ==========================================

        function copyResults() {
            const results = buildResultsText();
            navigator.clipboard.writeText(results).then(() => {
                alert('‚úÖ Results copied to clipboard!');
            }).catch(err => {
                // Fallback for file:// protocol
                const ta = document.createElement('textarea');
                ta.value = results;
                document.body.appendChild(ta);
                ta.select();
                document.execCommand('copy');
                document.body.removeChild(ta);
                alert('‚úÖ Results copied to clipboard!');
            });
        }

        // ==========================================
        // SUBMIT TO METAPM
        // ==========================================

        async function submitToMetaPM() {
            const project = document.getElementById('config-project').value.trim();
            const version = document.getElementById('config-version').value.trim();
            const feature = document.getElementById('config-feature').value.trim();
            const resultDiv = document.getElementById('submit-result');
            const submitBtn = document.getElementById('submit-btn');

            if (!project || !version) {
                resultDiv.className = 'submit-result error';
                resultDiv.innerHTML = '‚ùå Please fill in Project and Version fields above.';
                return;
            }

            const passed = document.querySelectorAll('.test-item.passed').length;
            const failed = document.querySelectorAll('.test-item.failed').length;
            const skipped = document.querySelectorAll('.test-item.skipped').length;
            const total = passed + failed;

            if (total === 0) {
                resultDiv.className = 'submit-result error';
                resultDiv.innerHTML = '‚ùå No test results found. Complete the UAT first (mark tests as Pass or Fail).';
                return;
            }

            const notesCount = Array.from(document.querySelectorAll('.test-item .notes-input'))
                .filter(input => input.value.trim().length > 0).length;

            const status = failed === 0 ? 'passed' : 'failed';
            const resultsText = buildResultsText();

            console.log('=== UAT Submit Debug ===');
            console.log('Project:', project, 'Version:', version);
            console.log('Status:', status, 'Passed:', passed, 'Failed:', failed, 'Skipped:', skipped);

            submitBtn.disabled = true;
            submitBtn.textContent = '‚è≥ Submitting...';

            try {
                const response = await fetch('https://metapm.rentyourcio.com/mcp/uat/submit', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        project: project,
                        version: version,
                        feature: feature || null,
                        status: status,
                        total_tests: total,
                        passed: passed,
                        failed: failed,
                        skipped: skipped,
                        notes_count: notesCount,
                        results_text: resultsText,
                        checklist_path: window.location.pathname || window.location.href,
                        url: window.location.href,
                        tested_by: 'Corey'
                    })
                });

                console.log('Response status:', response.status);
                const responseText = await response.text();
                console.log('Response body:', responseText);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${responseText}`);
                }

                const data = JSON.parse(responseText);
                resultDiv.className = 'submit-result success';
                resultDiv.innerHTML = `‚úÖ Submitted to MetaPM! <a href="${data.handoff_url}" target="_blank">View in MetaPM ‚Üí</a>` +
                    `<br><small>Handoff ID: ${data.handoff_id} | UAT ID: ${data.uat_id}</small>`;

                // Save submit confirmation to auto-save state
                scheduleAutoSave();
            } catch (err) {
                console.error('Submit error:', err);
                resultDiv.className = 'submit-result error';
                resultDiv.innerHTML = `‚ùå Submit failed: ${err.message}<br><small>Results have been auto-saved locally. Use "Copy Results" as backup.</small>`;
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'üì§ Submit to MetaPM';
            }
        }

        // ==========================================
        // INIT
        // ==========================================

        // Load saved state on page load
        const restored = loadState();
        if (restored) {
            console.log('UAT state restored from localStorage');
        }
    </script>
</body>
</html>
